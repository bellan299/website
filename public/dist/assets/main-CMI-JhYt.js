(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function t(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(n){if(n.ep)return;n.ep=!0;const i=t(n);fetch(n.href,i)}})();let d=null,m=null;function f(){window.firebase&&window.firebase.auth?(d=window.firebase.auth(),d&&(d.languageCode="en"),d&&window.firebase&&window.firebase.auth&&(m=new window.firebase.auth.RecaptchaVerifier("recaptcha-container",{}),window.recaptchaVerifier=m)):console.error("Firebase not available for AuthUI initialization")}document.addEventListener("DOMContentLoaded",()=>{f();try{window.authUI=new h}catch(c){console.error("Error creating AuthUI instance:",c),window.authUI=null}if(window.pendingModals&&window.pendingModals.length>0){const c=window.pendingModals.shift();c&&window.authUI&&window.authUI.showModal(c),window.pendingModals=[]}setTimeout(()=>{document.querySelector(".signin-btn"),document.querySelector(".signup-btn")},1e3)});if(document.readyState!=="loading"){f();try{window.authUI=new h}catch(c){console.error("Error creating AuthUI instance (immediate):",c),window.authUI=null}if(window.pendingModals&&window.pendingModals.length>0){const c=window.pendingModals.shift();c&&window.authUI&&window.authUI.showModal(c),window.pendingModals=[]}}class h{constructor(){this.currentModal=null,this.init()}init(){this.bindEvents(),this.setupFormValidation()}bindEvents(){document.addEventListener("click",e=>{e.target.classList.contains("auth-modal")&&this.closeCurrentModal()}),document.addEventListener("keydown",e=>{e.key==="Escape"&&this.currentModal&&this.closeCurrentModal()}),document.getElementById("login-form")?.addEventListener("submit",e=>this.handleLogin(e)),document.getElementById("register-form")?.addEventListener("submit",e=>this.handleRegister(e)),document.getElementById("forgot-password-form")?.addEventListener("submit",e=>this.handleForgotPassword(e)),document.getElementById("phone-login-form")?.addEventListener("submit",e=>this.handlePhoneLogin(e)),document.getElementById("phone-register-form")?.addEventListener("submit",e=>this.handlePhoneRegister(e)),this.initializeAuthObserver()}showModal(e){const t=document.getElementById(`${e}-modal`);if(t){this.closeCurrentModal(),t.classList.add("active"),this.currentModal=e;const o=t.querySelector("input");o&&setTimeout(()=>o.focus(),100)}else console.error("Modal not found for type:",e),console.error("Available modals:",document.querySelectorAll(".auth-modal").length),document.querySelectorAll(".auth-modal").forEach(o=>{console.log("Available modal ID:",o.id)})}closeCurrentModal(){if(this.currentModal){const e=document.getElementById(`${this.currentModal}-modal`);e&&e.classList.remove("active"),this.currentModal=null}}setupFormValidation(){const e=document.getElementById("register-password");e&&e.addEventListener("input",s=>this.checkPasswordStrength(s.target.value));const t=document.getElementById("register-confirm-password");t&&t.addEventListener("input",s=>this.checkPasswordMatch(s.target.value));const o=document.getElementById("register-dob");o&&o.addEventListener("change",s=>this.verifyAge(s.target.value));const n=document.getElementById("phone-login-number");n&&n.addEventListener("input",s=>this.formatPhoneInput(s.target));const i=document.getElementById("phone-register-number");i&&i.addEventListener("input",s=>this.formatPhoneInput(s.target))}formatPhoneInput(e){let t=e.value.replace(/\D/g,"");t=t.substring(0,10),t.length>=6?t=`(${t.substring(0,3)}) ${t.substring(3,6)}-${t.substring(6)}`:t.length>=3?t=`(${t.substring(0,3)}) ${t.substring(3)}`:t.length>0&&(t=`(${t}`),e.value=t}checkPasswordStrength(e){const t={length:e.length>=8,uppercase:/[A-Z]/.test(e),lowercase:/[a-z]/.test(e),number:/\d/.test(e),special:/[!@#$%^&*(),.?":{}|<>]/.test(e)};Object.keys(t).forEach(s=>{const r=document.querySelector(`[data-requirement="${s}"]`);if(r){const a=r.querySelector("i");t[s]?(a.className="fas fa-check",r.style.color="var(--success)"):(a.className="fas fa-circle",r.style.color="var(--muted)")}});const o=Object.values(t).filter(Boolean).length,n=document.getElementById("strength-fill"),i=document.getElementById("strength-text");if(n&&i){const s=o/5*100;n.style.width=`${s}%`,o<=2?(n.style.backgroundColor="#ff4444",i.textContent="Weak"):o<=3?(n.style.backgroundColor="#ffaa00",i.textContent="Fair"):o<=4?(n.style.backgroundColor="#ffdd00",i.textContent="Good"):(n.style.backgroundColor="#00aa00",i.textContent="Strong")}}checkPasswordMatch(e){const t=document.getElementById("register-password")?.value,o=document.getElementById("register-confirm-password-error");o&&(e&&t!==e?(o.textContent="Passwords do not match",o.style.display="block"):o.style.display="none")}verifyAge(e){const t=document.getElementById("register-dob-error");if(t){const o=new Date(e),n=new Date,i=n.getFullYear()-o.getFullYear(),s=n.getMonth()-o.getMonth();(s<0||s===0&&n.getDate()<o.getDate())&&i--,i<21?(t.textContent="You must be 21 or older to create an account",t.style.display="block"):t.style.display="none"}}async handleLogin(e){e.preventDefault();const t=e.target,o=t.querySelector(".auth-button"),n=o.querySelector(".button-text"),i=o.querySelector(".loading-spinner");n.style.display="none",i.style.display="inline-block",o.disabled=!0;try{const s=new FormData(t),r=Object.fromEntries(s);if(!d)throw new Error("Authentication not available. Please refresh the page.");if(!(await d.signInWithEmailAndPassword(r.email,r.password)).user.emailVerified)throw await d.signOut(),new Error("Please verify your email address before signing in. Check your inbox for a verification link.");this.showSuccess("Login successful!"),this.closeCurrentModal()}catch(s){console.error("Login error:",s);let r="Login failed. Please try again.";s.code==="auth/user-not-found"?r="No account found with this email address.":s.code==="auth/wrong-password"?r="Incorrect password. Please try again.":s.code==="auth/invalid-email"?r="Please enter a valid email address.":s.code==="auth/user-disabled"?r="This account has been disabled. Please contact support.":s.message.includes("verify your email")&&(r=s.message),this.showError(r)}finally{n.style.display="inline-block",i.style.display="none",o.disabled=!1}}async handleRegister(e){e.preventDefault();const t=e.target,o=t.querySelector(".auth-button"),n=o.querySelector(".button-text"),i=o.querySelector(".loading-spinner");n.style.display="none",i.style.display="inline-block",o.disabled=!0;try{const s=new FormData(t),r=Object.fromEntries(s);if(!this.validateRegistration(r))throw new Error("Please fill in all required fields correctly");if(!d)throw new Error("Authentication not available. Please refresh the page.");const l=(await d.createUserWithEmailAndPassword(r.email,r.password)).user;await l.updateProfile({displayName:`${r.firstName} ${r.lastName}`}),await l.sendEmailVerification();const u={firstName:r.firstName,lastName:r.lastName,phone:r.phone||"",dateOfBirth:r.dateOfBirth||"",emailNotifications:r.emailNotifications==="on",smsNotifications:r.smsNotifications==="on",marketingEmails:r.marketingEmails==="on"};localStorage.setItem("userData",JSON.stringify(u)),this.closeCurrentModal(),this.showModal("verification")}catch(s){console.error("Registration error:",s);let r="Registration failed. Please try again.";s.code==="auth/email-already-in-use"?r="An account with this email already exists.":s.code==="auth/weak-password"?r="Password is too weak. Please choose a stronger password.":s.code==="auth/invalid-email"?r="Please enter a valid email address.":s.code==="auth/operation-not-allowed"&&(r="Email/password registration is not enabled. Please contact support."),this.showError(r)}finally{n.style.display="inline-block",i.style.display="none",o.disabled=!1}}async handleForgotPassword(e){e.preventDefault();const t=e.target,o=t.querySelector(".auth-button"),n=o.querySelector(".button-text"),i=o.querySelector(".loading-spinner");n.style.display="none",i.style.display="inline-block",o.disabled=!0;try{const r=new FormData(t).get("email");if(!d)throw new Error("Authentication not available. Please refresh the page.");await d.sendPasswordResetEmail(r),this.showSuccess("Password reset link sent to your email!"),this.closeCurrentModal()}catch(s){console.error("Password reset error:",s);let r="Failed to send reset link. Please try again.";s.code==="auth/user-not-found"?r="No account found with this email address.":s.code==="auth/invalid-email"&&(r="Please enter a valid email address."),this.showError(r)}finally{n.style.display="inline-block",i.style.display="none",o.disabled=!1}}async handlePhoneLogin(e){e.preventDefault();const o=e.target.querySelector(".auth-button"),n=o.querySelector(".button-text"),i=o.querySelector(".loading-spinner"),s=document.getElementById("verification-code-group");let r=document.getElementById("phone-login-number").value;n.style.display="none",i.style.display="inline-block",o.disabled=!0;try{if(!s.style.display||s.style.display==="none"){if(!d)throw new Error("Authentication not available. Please refresh the page.");if(r=this.formatPhoneNumber(r),!r)throw new Error("Please enter a valid phone number in format: (555) 123-4567");const a=await d.signInWithPhoneNumber(r,window.recaptchaVerifier);window.phoneConfirmationResult=a,s.style.display="block",n.textContent="Verify Code",document.getElementById("verification-code").focus(),this.showSuccess(`Verification code sent to ${r}`)}else{const a=document.getElementById("verification-code").value;if(!a||a.length!==6)throw new Error("Please enter a valid 6-digit code");if(!window.phoneConfirmationResult)throw new Error("Verification session expired. Please try again.");const u=(await window.phoneConfirmationResult.confirm(a)).user;console.log("Phone authentication successful:",u),this.showSuccess("Phone verification successful!"),this.closeCurrentModal()}}catch(a){console.error("Phone authentication error:",a);let l="Phone verification failed. Please try again.";a.code==="auth/invalid-phone-number"?l="Please enter a valid phone number in format: (555) 123-4567":a.code==="auth/invalid-verification-code"?l="Invalid verification code. Please try again.":a.code==="auth/quota-exceeded"?l="Too many attempts. Please try again later.":(a.message.includes("valid 6-digit code")||a.message.includes("valid phone number"))&&(l=a.message),this.showError(l)}finally{n.style.display="inline-block",i.style.display="none",o.disabled=!1}}async handlePhoneRegister(e){e.preventDefault();const t=e.target,o=t.querySelector(".auth-button"),n=o.querySelector(".button-text"),i=o.querySelector(".loading-spinner"),s=document.getElementById("phone-verification-code-group");n.style.display="none",i.style.display="inline-block",o.disabled=!0;try{if(!s.style.display||s.style.display==="none"){const r=new FormData(t),a=Object.fromEntries(r);if(!this.validatePhoneRegistration(a))throw new Error("Please fill in all required fields correctly");if(!d)throw new Error("Authentication not available. Please refresh the page.");let l=this.formatPhoneNumber(a.phoneNumber);if(!l)throw new Error("Please enter a valid phone number in format: (555) 123-4567");const u=await d.signInWithPhoneNumber(l,window.recaptchaVerifier);window.phoneConfirmationResult=u,s.style.display="block",n.textContent="Verify Code",document.getElementById("phone-verification-code").focus(),this.showSuccess(`Verification code sent to ${l}`)}else{const r=document.getElementById("phone-verification-code").value;if(!r||r.length!==6)throw new Error("Please enter a valid 6-digit code");if(!window.phoneConfirmationResult)throw new Error("Verification session expired. Please try again.");const l=(await window.phoneConfirmationResult.confirm(r)).user;await l.updateProfile({displayName:`${document.getElementById("phone-register-firstname").value} ${document.getElementById("phone-register-lastname").value}`});const u={firstName:document.getElementById("phone-register-firstname").value,lastName:document.getElementById("phone-register-lastname").value,phone:document.getElementById("phone-register-number").value,dateOfBirth:document.getElementById("phone-register-dob").value,smsNotifications:document.getElementById("phone-marketing-consent").checked};localStorage.setItem("userData",JSON.stringify(u)),console.log("Phone registration successful:",l),this.showSuccess("Account created successfully!"),this.closeCurrentModal()}}catch(r){console.error("Phone registration error:",r);let a="Phone registration failed. Please try again.";r.code==="auth/invalid-phone-number"?a="Please enter a valid phone number in format: (555) 123-4567":r.code==="auth/invalid-verification-code"?a="Invalid verification code. Please try again.":r.code==="auth/quota-exceeded"?a="Too many attempts. Please try again later.":(r.message.includes("valid 6-digit code")||r.message.includes("valid phone number"))&&(a=r.message),this.showError(a)}finally{n.style.display="inline-block",i.style.display="none",o.disabled=!1}}validatePhoneRegistration(e){return!(!e.firstName||!e.lastName||!e.phoneNumber||!e.dateOfBirth||!e.termsAccept)}validateRegistration(e){return!(!e.firstName||!e.lastName||!e.email||!e.password||e.password!==e.confirmPassword||!e.termsAccept)}showSuccess(e){const t=document.createElement("div");t.className="notification success",t.textContent=e,t.style.cssText=`
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--success);
            color: white;
            padding: 12px 20px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            z-index: 3000;
            animation: slideIn 0.3s ease;
        `,document.body.appendChild(t),setTimeout(()=>{t.remove()},3e3)}showError(e){const t=document.createElement("div");t.className="notification error",t.textContent=e,t.style.cssText=`
            position: fixed;
            top: 20px;
            right: 20px;
            background: #ff4444;
            color: white;
            padding: 12px 20px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            z-index: 3000;
            animation: slideIn 0.3s ease;
        `,document.body.appendChild(t),setTimeout(()=>{t.remove()},3e3)}initializeAuthObserver(){window.firebaseAuth&&window.firebaseAuth.auth&&window.firebaseAuth.auth.onAuthStateChanged(e=>{e?(console.log("User is signed in:",e),window.auth&&window.auth.setUser({id:e.uid,email:e.email,name:e.displayName,firstName:e.displayName?.split(" ")[0]||"",lastName:e.displayName?.split(" ").slice(1).join(" ")||"",picture:e.photoURL,provider:e.providerData[0]?.providerId||"unknown"})):(console.log("User is signed out"),window.auth&&window.auth.logout())})}formatPhoneNumber(e){const t=e.replace(/\D/g,"");return t.length===10?`+1${t}`:t.length===11&&t.startsWith("1")?`+${t}`:e.startsWith("+1")&&t.length===11?e:null}}document.addEventListener("click",c=>{const e=document.querySelector(".user-menu"),t=document.getElementById("user-dropdown");e&&t&&!e.contains(c.target)&&t.classList.remove("show")});document.addEventListener("click",c=>{const e=document.querySelector(".user-menu"),t=document.getElementById("user-dropdown");e&&t&&!e.contains(c.target)&&t.classList.remove("show")});document.addEventListener("DOMContentLoaded",()=>{window.authUI=new h});const g=document.createElement("style");g.textContent=`
    @keyframes slideIn {
        from {
            transform: translateX(100%);
            opacity: 0;
        }
        to {
            transform: translateX(0);
            opacity: 1;
        }
    }
`;document.head.appendChild(g);class p{constructor(){this.isAuthenticated=!1,this.currentUser=null,this.init()}init(){this.checkAuthState()}checkAuthState(){const e=localStorage.getItem("authToken"),t=localStorage.getItem("user");if(e&&t)try{this.currentUser=JSON.parse(t),this.isAuthenticated=!0,this.updateUI()}catch(o){console.error("Error parsing stored user data:",o),this.logout()}}updateUI(){if(this.isAuthenticated&&this.currentUser){const e=document.querySelector(".nav-auth");e&&(e.innerHTML=`
                    <div class="user-menu">
                        <button class="user-btn" onclick="showUserMenu()">
                            <img src="${this.currentUser.picture||"/default-avatar.png"}" alt="${this.currentUser.name}" class="user-avatar">
                            <span>${this.currentUser.firstName||this.currentUser.name}</span>
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <div class="user-dropdown" id="user-dropdown">
                            <a href="#" onclick="showAuthModal('profile')">Profile</a>
                            <a href="#" onclick="logout()">Sign Out</a>
                        </div>
                    </div>
                `)}else{const e=document.querySelector(".nav-auth");e&&(e.innerHTML=`
                    <button class="auth-btn signin-btn" onclick="showAuthModal('login')">Sign In</button>
                    <button class="auth-btn signup-btn" onclick="showAuthModal('register')">Sign Up</button>
                `)}}setUser(e){this.currentUser=e,this.isAuthenticated=!0,localStorage.setItem("user",JSON.stringify(e)),localStorage.setItem("authToken","dummy-token"),this.updateUI()}logout(){this.currentUser=null,this.isAuthenticated=!1,localStorage.removeItem("user"),localStorage.removeItem("authToken"),this.updateUI()}getUser(){return this.currentUser}isLoggedIn(){return this.isAuthenticated}}window.auth=new p;class y{constructor(){this.products=[],this.filteredProducts=[],this.currentCategory="",this.currentSort="name",this.init()}init(){this.bindEvents(),this.loadProducts(),this.setupMobileMenu()}bindEvents(){const e=document.getElementById("category-filter");e&&e.addEventListener("change",n=>{this.filterProducts(n.target.value,this.currentSort)});const t=document.getElementById("sort-filter");t&&t.addEventListener("change",n=>{this.filterProducts(this.currentCategory,n.target.value)});const o=document.getElementById("contact-form");o&&o.addEventListener("submit",n=>this.handleContactForm(n)),document.querySelectorAll('a[href^="#"]').forEach(n=>{n.addEventListener("click",function(i){i.preventDefault();const s=document.querySelector(this.getAttribute("href"));s&&s.scrollIntoView({behavior:"smooth",block:"start"})})})}setupMobileMenu(){const e=document.querySelector(".nav-toggle"),t=document.querySelector(".nav-menu"),o=document.querySelector(".nav-auth");e&&t&&e.addEventListener("click",()=>{t.classList.toggle("active"),e.classList.toggle("active"),o&&o.classList.toggle("active")})}async loadProducts(){try{this.showLoading(!0),await this.simulateProductLoading(),this.renderProducts(),this.renderBestSellers(),this.renderNewArrivals()}catch(e){console.error("Error loading products:",e),this.showError("Failed to load products. Please try again.")}finally{this.showLoading(!1)}}async simulateProductLoading(){try{const t=await(await fetch("/api/products")).json();t.success?(this.products=t.products.map(o=>({...o,image:o.image||this.getDefaultImageForCategory(o.category)})),console.log(`Loaded ${this.products.length} products from Clover`)):(console.error("Failed to load products:",t.error),this.products=[])}catch(e){console.error("Error loading products from Clover:",e),this.products=[]}this.filteredProducts=[...this.products]}getDefaultImageForCategory(e){const t={wine:"https://images.unsplash.com/photo-1510812431401-41d2bd2722f3?w=300&h=300&fit=crop",spirits:"https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=300&h=300&fit=crop",beer:"https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?w=300&h=300&fit=crop",seltzer:"https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=300&h=300&fit=crop",thc:"https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=300&h=300&fit=crop",other:"https://via.placeholder.com/160x180/f3e9e6/7b1e3a?text=Product"};return t[e]||t.other}filterProducts(e="",t="name"){this.currentCategory=e,this.currentSort=t;let o=this.products;e&&(o=this.products.filter(n=>n.category===e)),o.sort((n,i)=>{switch(t){case"price-low":return n.price-i.price;case"price-high":return i.price-n.price;case"popularity":return(i.isBestSeller?1:0)-(n.isBestSeller?1:0);case"name":default:return n.name.localeCompare(i.name)}}),this.filteredProducts=o,this.renderProducts()}renderProducts(){const e=document.getElementById("all-products-grid");e&&(e.innerHTML=this.filteredProducts.map(t=>this.createProductCard(t)).join(""))}renderBestSellers(){const e=document.getElementById("bestsellers-grid");if(!e)return;const t=this.products.filter(o=>o.isBestSeller);e.innerHTML=t.map(o=>this.createProductCard(o)).join("")}renderNewArrivals(){const e=document.getElementById("newarrivals-grid");if(!e)return;const t=this.products.filter(o=>o.isNewArrival);e.innerHTML=t.map(o=>this.createProductCard(o)).join("")}createProductCard(e){return`
            <div class="product-card">
                ${e.isBestSeller?'<div class="product-badge">Best Seller</div>':e.isNewArrival?'<div class="product-badge new">New</div>':""}
                <img src="${e.image}" alt="${e.name}" class="product-image" onerror="this.src='https://via.placeholder.com/160x180/f3e9e6/7b1e3a?text=Product'">
                <h3 class="product-name">${e.name}</h3>
                <p class="product-price">$${e.price.toFixed(2)}</p>
                <button class="add-to-cart" onclick="addToCart(${e.id})">Add to Cart</button>
            </div>
        `}showLoading(e){const t=document.getElementById("loading-modal");t&&(e?t.classList.add("active"):t.classList.remove("active"))}showError(e){const t=document.createElement("div");t.className="notification error",t.textContent=e,t.style.cssText=`
            position: fixed;
            top: 20px;
            right: 20px;
            background: #ff4444;
            color: white;
            padding: 12px 20px;
            border-radius: 14px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
            z-index: 3000;
            animation: slideIn 0.3s ease;
        `,document.body.appendChild(t),setTimeout(()=>{t.remove()},3e3)}async handleContactForm(e){e.preventDefault();const t=e.target,o=t.querySelector(".submit-button"),n=o.textContent;o.textContent="Sending...",o.disabled=!0;try{await new Promise(i=>setTimeout(i,2e3)),this.showSuccess("Message sent successfully! We'll get back to you soon."),t.reset()}catch{this.showError("Failed to send message. Please try again.")}finally{o.textContent=n,o.disabled=!1}}showSuccess(e){const t=document.createElement("div");t.className="notification success",t.textContent=e,t.style.cssText=`
            position: fixed;
            top: 20px;
            right: 20px;
            background: #2e7d32;
            color: white;
            padding: 12px 20px;
            border-radius: 14px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
            z-index: 3000;
            animation: slideIn 0.3s ease;
        `,document.body.appendChild(t),setTimeout(()=>{t.remove()},3e3)}}document.addEventListener("DOMContentLoaded",()=>{window.website=new y});
